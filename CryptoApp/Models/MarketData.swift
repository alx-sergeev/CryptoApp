//
//  MarketData.swift
//  CryptoApp
//
//  Created by Сергеев Александр on 10.10.2023.
//

import Foundation

// JSON data:
/*
 URL: https://api.coingecko.com/api/v3/
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 10371,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 891,
     "total_market_cap": {
       "btc": 40234908.14410182,
       "eth": 700307405.5248448,
       "ltc": 17604496943.879147,
       "bch": 5098728461.926616,
       "bnb": 5340386890.5341,
       "eos": 2045862599103.1694,
       "xrp": 2232715606423.63,
       "xlm": 10599459049272.31,
       "link": 151501540207.7979,
       "dot": 289817134690.13245,
       "yfi": 214231213.20579487,
       "usd": 1113642266985.2383,
       "aed": 4090491569806.7817,
       "ars": 389806309520988.8,
       "aud": 1733302892677.0325,
       "bdt": 122266815674292.67,
       "bhd": 419844248295.7032,
       "bmd": 1113642266985.2383,
       "brl": 5720891689729.849,
       "cad": 1512260493672.1992,
       "chf": 1006949769596.7172,
       "clp": 1025720210006752.6,
       "cny": 8119231675909.257,
       "czk": 25802200412234.37,
       "dkk": 7831338445259.575,
       "eur": 1050261544644.3043,
       "gbp": 907673016064.0486,
       "hkd": 8707594499329.721,
       "huf": 406992854398527.94,
       "idr": 17512997159838996,
       "ils": 4401166580312.196,
       "inr": 92671577541763.05,
       "jpy": 165657628140855.06,
       "krw": 1498372382347634.8,
       "kwd": 344254665781.81134,
       "lkr": 359058199958976.94,
       "mmk": 2328956495927264,
       "mxn": 20230941038423.41,
       "myr": 5265857459439.683,
       "ngn": 856190447703589,
       "nok": 12044537801896.402,
       "nzd": 1849160665922.8413,
       "php": 63275476464847.266,
       "pkr": 312185505876084.7,
       "pln": 4785494549429.226,
       "rub": 111252869153678.94,
       "sar": 4177307780014.178,
       "sek": 12138453481555.83,
       "sgd": 1519383349611.8357,
       "thb": 41015444693066.19,
       "try": 30875842102750.113,
       "twd": 35766625960311.47,
       "uah": 40521721416778.9,
       "vef": 111509000193.23158,
       "vnd": 27188538391330880,
       "zar": 21337379153583.54,
       "xdr": 845246685145.9276,
       "xag": 51125545786.08773,
       "xau": 598994766.143351,
       "bits": 40234908144101.82,
       "sats": 4023490814410182
     },
     "total_volume": {
       "btc": 1515276.580919998,
       "eth": 26374098.015486598,
       "ltc": 662998455.0330887,
       "bch": 192021908.01969612,
       "bnb": 201122944.2676073,
       "eos": 77048707880.68639,
       "xrp": 84085731180.28282,
       "xlm": 399183515226.62384,
       "link": 5705660741.861011,
       "dot": 10914728955.574154,
       "yfi": 8068106.906325997,
       "usd": 41940596475.12233,
       "aed": 154050956397.8591,
       "ars": 14680395685173.05,
       "aud": 65277476749.985176,
       "bdt": 4604659261340.378,
       "bhd": 15811646811.717644,
       "bmd": 41940596475.12233,
       "brl": 215453038152.3502,
       "cad": 56952855518.024,
       "chf": 37922477629.82322,
       "clp": 38629386383411.375,
       "cny": 305776306721.1736,
       "czk": 971730067851.4038,
       "dkk": 294934033423.4076,
       "eur": 39553631307.93358,
       "gbp": 34183641216.451866,
       "hkd": 327934488472.7005,
       "huf": 15327653754374.912,
       "idr": 659552505077922.8,
       "ils": 165751208477.71725,
       "inr": 3490080570409.6113,
       "jpy": 6238789547463.868,
       "krw": 56429818910907.82,
       "kwd": 12964886885.372173,
       "lkr": 13522398998315.723,
       "mmk": 87710234695227.33,
       "mxn": 761912294063.2385,
       "myr": 198316110432.6153,
       "ngn": 32244769382003.477,
       "nok": 453606256384.4749,
       "nzd": 69640766704.27452,
       "php": 2383001529178.163,
       "pkr": 11757138459530.428,
       "pln": 180225285786.651,
       "rub": 4189865839508.3003,
       "sar": 157320519477.27127,
       "sek": 457143190766.416,
       "sgd": 57221107573.07885,
       "thb": 1544672168178.75,
       "try": 1162807189391.8157,
       "twd": 1346997748872.2075,
       "uah": 1526078182196.8809,
       "vef": 4199511925.053986,
       "vnd": 1023940587767126.4,
       "zar": 803581576819.7639,
       "xdr": 31832619140.442543,
       "xag": 1925426098.6244686,
       "xau": 22558588.626074076,
       "bits": 1515276580919.998,
       "sats": 151527658091999.8
     },
     "market_cap_percentage": {
       "btc": 48.48872113594721,
       "eth": 17.176671559593572,
       "usdt": 7.491831323601572,
       "bnb": 2.880946190279269,
       "xrp": 2.392391022767839,
       "usdc": 2.2879542453925166,
       "steth": 1.2603583706024324,
       "sol": 0.8315308123468623,
       "ada": 0.7899012109703576,
       "doge": 0.7505169130499916
     },
     "market_cap_change_percentage_24h_usd": -1.1214702975771118,
     "updated_at": 1696928057
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
